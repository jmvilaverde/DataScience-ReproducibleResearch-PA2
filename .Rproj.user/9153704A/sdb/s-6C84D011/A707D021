{
    "contents" : "---\ntitle: Data Science - Reproducible Research - Peer Assessment 2 - Analysis of Weather Event using NOAA Storm Database \nauthor: \"jmvilaverde\"\ndate: \"Monday, June 15, 2015\"\noutput:\n  html_document:\n    keep_md: yes\n    pandoc_args:\n    - +RTS\n    - -K64m\n    - -RTS\n---\n\n\n\n\n***\n\n##Title: Your document should have a title that briefly summarizes your data analysis\n\n#Analysis of Weather Event using NOAA Storm Database \n\n* Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?\n\n* Across the United States, which types of events have the greatest economic consequences?\n\nConsider writing your report as if it were to be read by a government or municipal manager who might be responsible for preparing for severe weather events and will need to prioritize resources for different types of events. However, there is no need to make any specific recommendations in your report.\n\n\n\n##Synopsis: \n\nImmediately after the title, there should be a synopsis which describes and summarizes your analysis in at most 10 complete sentences.\n\n1.\n2.\n3.\n4.\n5.\n6.\n7.\n8.\n9.\n10.\n\n##Data Processing\n\nThere should be a section titled Data Processing which describes (in words and code) how the data were loaded into R and processed for analysis. In particular, your analysis must start from the raw CSV file containing the data. You cannot do any preprocessing outside the document. If preprocessing is time-consuming you may consider using the cache = TRUE option for certain code chunks.\n\nFirst step, adquire the date from \"https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2\" and put into a data frame container:\n\n```{r dataAdquisition, echo=TRUE, cache=TRUE}\n#Set data path, using setInternet2 to avoid problems with https download\nsetInternet2(use = TRUE)\ndataPath <- \"https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2\"\nfileName <- \"StormData.csv.bz2\"\n\n#Download the file\nif (!file.exists(fileName)) download.file(url = dataPath, destfile = fileName)\n\n#Extract bz2 file to a dataframe\ndataInitial <- read.csv(bzfile(fileName))\n```\n\nAs additional information, on [http://www.ncdc.noaa.gov/stormevents/details.jsp?type=eventtype]\ninform about information recolection, and only have a complete collection from 1996 to present:\n_3. All Event Types (48 from Directive 10-1605): From 1996 to present, 48 event types are recorded as defined in NWS Directive 10-1605._\n\n\n\nGet only relevant fields:\n```{r processData, echo=TRUE}\n#Identify fields\nnames(dataInitial)\n#Identify structure\nstr(dataInitial)\n#Get a general overview\nsummary(dataInitial)\n```\n\n```{r filter, echo=TRUE}\n\n#Data filtered by year >= 1996\nlibrary(lubridate)\ndataInitial$date <- as.Date(dataInitial$BGN_DATE, format = \"%m/%d/%Y\")\ndataInitial$year <- year(dataInitial$date)\ndataYearProcessed <- dataInitial[dataInitial$year>=1996,]\n\n#Percent of data removed filtering by Year\nsummary(dataInitial$year>=1996)\npercentDataRemYear <- sum(!dataInitial$year>=1996)/nrow(dataInitial)\n\n#Data filtered by States\ndataStatesProcessed <- dataYearProcessed[dataYearProcessed$STATE %in% state.abb,]\n\n#Percent of data removed filtering by State\nsummary(dataYearProcessed$STATE %in% state.abb)\npercentDataRemStates <- sum(!dataYearProcessed$STATE %in% state.abb)/nrow(dataYearProcessed)\n\nsummary(dataStatesProcessed)\n```\n\n```{r processFilterData, echo=TRUE}\nlibrary(dplyr)\n\n#Select only necesary fields: Type of event, Number of fatalities, Number of injuries, Property damages, Property damages exponent,\n#Crop damages, and Crop damages exponent.\ndataStatesProcessed %>% \n        select(EVTYPE, FATALITIES, INJURIES, PROPDMG, PROPDMGEXP, CROPDMG, CROPDMGEXP) -> dataPreprocessed\n        \n\n#Evaluate how many levels have the dataset\nunique(dataPreprocessed$EVTYPE)\n\n#Remove Summary from event type\ndataPreprocessed <- dataPreprocessed[!grepl(pattern = \"Summary\", x=dataPreprocessed$EVTYPE),]\n\n#Create Property damage total\n#Type of exponents -> Billion, Million, K thousand\nsummary(dataPreprocessed)\ndataPreprocessed %>%\n         mutate(CombinedHealthDamage = FATALITIES + INJURIES) -> dataPreprocessed \n\ndataPreprocessed %>%\n         mutate(multiPROPDM = ifelse(PROPDMGEXP == 'B', 10^9, \n                                     ifelse(PROPDMGEXP == 'M', 10^6, \n                                            ifelse(PROPDMGEXP == 'K', 10^3, \n                                                   ifelse(PROPDMGEXP == 'H', 100, 1))))) %>%\n         mutate(totalPROPDMG = as.numeric(multiPROPDM) * as.numeric(PROPDMG)) -> dataPreprocessed\n```\n\n```{r getFatalitiesAndInjuries, echo=TRUE}\n##TOP 20 of Fatalities per Event Type\ndataAgregateFatalities <- with(dataPreprocessed, aggregate(FATALITIES, list(EVTYPE), sum))\ndataAgregateFatalities <- rename(dataAgregateFatalities, EVTYPE = Group.1, FATALITIES = x)\ndAFatalitiesTop20 <-arrange(dataAgregateFatalities,desc(FATALITIES))[1:20,]\n\n#TOP 20 of Injuries per Event Type\ndataAgregateINJURIES <- with(dataPreprocessed, aggregate(INJURIES, list(EVTYPE), sum))\ndataAgregateINJURIES <- rename(dataAgregateINJURIES, EVTYPE = Group.1, INJURIES = x)\ndAINJURIESTop20 <- arrange(dataAgregateINJURIES, desc(INJURIES))[1:20,]\n\n#TOP 20 of Combined Health Damage per Event Type\ndataAgregateCombined <- with(dataPreprocessed, aggregate(CombinedHealthDamage, list(EVTYPE), sum))\ndataAgregateCombined <- rename(dataAgregateCombined, EVTYPE = Group.1, CombinedHealthDamage = x)\ndACOMBINEDTop20 <- arrange(dataAgregateCombined, desc(CombinedHealthDamage))[1:20,]\n\n#Change the factor order\ndAFatalitiesTop20$EVTYPE <- factor(dAFatalitiesTop20$EVTYPE, levels = dAFatalitiesTop20$EVTYPE[order(dAFatalitiesTop20$FATALITIES)])\ndAINJURIESTop20$EVTYPE <- factor(dAINJURIESTop20$EVTYPE, levels = dAINJURIESTop20$EVTYPE[order(dAINJURIESTop20$INJURIES)])\ndACOMBINEDTop20$EVTYPE <- factor(dACOMBINEDTop20$EVTYPE, levels = dACOMBINEDTop20$EVTYPE[order(dACOMBINEDTop20$CombinedHealthDamage)])\n```\n\n```{r plotFatalitiesAndInjuries, echo=TRUE}\nlibrary(ggplot2)\n\ngf <- ggplot(data=dAFatalitiesTop20, aes(x=EVTYPE, y=FATALITIES , fill=EVTYPE))\ngf <- gf + geom_bar(stat=\"identity\", show_guide = FALSE)\ngf <- gf + coord_flip() + geom_text(aes(label=FATALITIES), vjust=0)\n\ngi <- ggplot(data=dAINJURIESTop20, aes(x=EVTYPE, y=INJURIES , fill=EVTYPE))\ngi <- gi + geom_bar(stat=\"identity\", show_guide = FALSE)\ngi <- gi + coord_flip() + geom_text(aes(label=INJURIES), vjust=0)\n\ngc <- ggplot(data=dACOMBINEDTop20, aes(x=EVTYPE, y=CombinedHealthDamage , fill=EVTYPE))\ngc <- gc + geom_bar(stat=\"identity\", show_guide = FALSE)\ngc <- gc + coord_flip() + geom_text(aes(label=CombinedHealthDamage), vjust=0)\n\nrequire(gridExtra)\nga <- grid.arrange(gf, gi, gc, nrow = 2, ncol=2)\nga\n```\n\n\n##Results\n\nThere should be a section titled Results in which your results are presented.\n\n##Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?\n\n##Across the United States, which types of events have the greatest economic consequences?\n\n",
    "created" : 1434370021313.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2350050355",
    "id" : "A707D021",
    "lastKnownWriteTime" : 1434449457,
    "path" : "D:/Privado/repos/5.ReproducibleResearch/PeerAssessment2/PA2.Rmd",
    "project_path" : "PA2.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}